<?xml version="1.0" encoding="UTF-8"?>

<section xml:id="euclideanrhythms" xmlns:xi="http://www.w3.org/2001/XInclude">
  <title>Euclidean Rhythms</title>

  <p>
    Our goal in this section is to describe one of the algorithms that generates maximally even rhythms.
    This algorithm is similar to the Euclidean algorithm.
    We will begin with reformulating the Euclidean algorithm as follows.
  </p>

  <algorithm xml:id="alg-euclideanremix">
    <statement>
      <p>
        Suppose <m>a\gt b</m> are positive integers.
        The algorithm <m>\textrm{EUCLID}(b,a)</m> runs as follows.
        <ol>
          <li>
            <p>
              If <m>b=0</m> then return <m>a</m>.
            </p>
          </li>
          <li>
            <p>
              Else, write <m>a=bq+r</m> and return <m>\textrm{EUCLID}(r,b)</m>.
            </p>
          </li>
        </ol>
      </p>
    </statement>
  </algorithm>

  <p>
    This is a concise way of writing the Euclidean algorithm using recursion and an if-else structure.
  </p>

  <exercise>
    <p>
      Work through the steps of <m>\textrm{EUCLID}(7,27)</m> with your group.
    </p>
  </exercise>

  <exercise>
    <p>
      Discuss the reformulated Euclidean algorithm above.
      Does it make sense why it is the same algorithm as the Euclidean algorithm we described previously?
      Why or why not?
    </p>
  </exercise>

  <p>
    We will now introduce an algorithm similar to the Euclidean algorithm that produces rhythms.
    This algorithm will be called <m>\textrm{ER}</m> for Euclidean Rhythm, it will have input a pair of integers <m>k,n</m> and it will output a distance sequence defining a rhythm.
  </p>

  <algorithm xml:id="alg-euclideanrhythm">
    <title>Euclidean Rhythm Algorithm</title>
    <statement>
      <p>
        Suppose <m>n\gt k</m> are positive integers.
        The algorithm <m>\textrm{ER}(k,n)</m> runs as follows.
        <ul>
          <li>
            <p>
              If <m>k</m> evenly divides <m>n</m>, then return
              <md>
                (\underbrace{\frac{n}{k},\frac{n}{k},\ldots, \frac{n}{k}}_{k\text{ times}}) \, .
              </md>
            </p>
          </li>
          <li>
            <p>
              Else, write <m>n=kq+r</m> with <m>0\leq r\lt k</m> and compute the sequence 
              <md>
                (x_1,\ldots,x_r)= \textrm{ER}(r,k) \, .
              </md>
              Then, return the sequence
              <md>
                (\underbrace{\left\lfloor \frac{n}{k} \right\rfloor,\ldots, \left\lfloor \frac{n}{k} \right\rfloor}_{x_1-1\text{ times}}, \left\lceil \frac{n}{k} \right\rceil, \underbrace{\left\lfloor \frac{n}{k} \right\rfloor,\ldots, \left\lfloor \frac{n}{k} \right\rfloor}_{x_2-1\text{ times}}, \left\lceil \frac{n}{k} \right\rceil,\ldots,\underbrace{\left\lfloor \frac{n}{k} \right\rfloor,\ldots, \left\lfloor \frac{n}{k} \right\rfloor}_{x_r-1\text{ times}}, \left\lceil \frac{n}{k} \right\rceil) \, .
              </md>
            </p>
          </li>
        </ul>
      </p>
    </statement>
  </algorithm>

  <p>
    Let's look at some examples.
  </p>
  <p>
    First, suppose that <m>n=12</m> and <m>k=4</m>.
    Then <m>\textrm{ER}(4,12)</m> returns <m>(3,3,3,3)</m>, since <m>4\mid 12</m>.
    This corresponds to the rhythm
    <md>
      [\times \cdot \cdot \cdot \times \cdot \cdot \cdot \times \cdot \cdot \cdot \times \cdot \cdot \cdot ]
    </md>
    which is maximally even.    
  </p>

  <p>
    Next consider <m>n=13</m> and <m>k=5</m>.
    <ul>
      <li>
        <p>
          Observe that since <m>5\nmid 13</m>, in the "else" step of the algorithm we will need to call <m>\textrm{ER}(3,5)</m> since <m>13=5\cdot 2 + 3</m>.
        </p>
      </li>
      <li>
        <p>
          In order to compute <m>\textrm{ER}(3,5)</m>, we will need to compute <m>\textrm{ER}(2,3)</m> in the "else" step.
        </p>
      </li>
      <li>
        <p>
          In order to compute <m>\textrm{ER}(2,3)</m>, we will need to compute <m>\textrm{ER}(1,2)</m> in the "else" step.
        </p>
      </li>
    </ul>
    Thus, in order to work backwards through the recursion, we need to start with <m>\textrm{ER}(1,2)=(2)</m>.
    From here, we can work in reverse order.
    <ul>
      <li>
        <p>
          <m>\textrm{ER}(2,3)=(1,2)</m>, since we have <m>(x_1)=(2)</m> and <m>\lfloor 3/2\rfloor=1</m> while <m>\lceil 3/2\rceil=2</m>.
        </p>
      </li>
      <li>
        <p>
          <m>\textrm{ER}(3,5)=(2,1,2)</m> since <m>(x_1,x_2)=(1,2)</m> and <m>\lfloor 5/3\rfloor=1</m> while <m>\lceil 5/3 \rceil=2</m>.
          So, there are <m>x_1-1=0</m> copies of <m>1</m> to start, followed by one copy of <m>2</m>, followed by one copy of <m>1</m>, followed by one copy of <m>2</m>.
        </p>
      </li>
      <li>
        <p>
          <m>\textrm{ER}(5,13)=(2,3,3,2,3)</m> since <m>(x_1,x_2,x_3)=(2,1,2)</m> and <m>\lfloor 13/5\rfloor=2</m> while <m>\lceil 13/5 \rceil=3</m>.
        </p>
      </li>
    </ul>
    Any rhythm that can be obtained by rotating the clock diagram for <m>(2,3,3,2,3)</m> is a Euclidean rhythm from <m>k=5</m> and <m>n=13</m>.
  </p>

  <exercise>
    <p>
      Discuss the example above. What questions do you have?
    </p>
  </exercise>

  <p>
    Note that if we rotate the clock diagram for <m>(2,3,3,2,3)</m> clockwise by three beats, then we get <m>(3,2,3,3,2)</m>, which is obtained from the original sequence by moving the last entry to the beginning of the sequence.
    Thus, if we have a Euclidean rhythm sequence, any sequence obtained by repeatedly moving the last entry to the beginning of the sequence is the same up to clock rotation, and is therefore maximally even.
  </p>

  <exercise>
    <p>
      Find all rotation-equivalent rhythms for the following Euclidean rhythms.
      <ol>
        <li>
          <p>
            <m>\textrm{ER}(3,8)</m> (generates the tresillo)
          </p>
        </li>
        <li>
          <p>
            <m>\textrm{ER}(5,8)</m> (generates the cinquillo)
          </p>
        </li>
        <li>
          <p>
            <m>\textrm{ER}(5,16)</m> (generates the Bossa-Nova)
          </p>
        </li>
        <li>
          <p>
            <m>\textrm{ER}(5,12)</m> (rotations include a common rhythm of the <em>Aka</em> Pygmies in Central Africa and the South African <em>Venda</em> clapping pattern from a children's song.) 
          </p>
        </li>
        <li>
          <p>
            <m>\textrm{ER}(7,16)</m> (includes a Samba rhythm from Brazil in the rotational patterns)
          </p>
        </li>
      </ol>
    </p>
  </exercise>

  <p>
  Demaine et al. prove that a rhythm is maximally even if and only if it is a rotation of one produced by the <m>\textrm{ER}</m> process.
  We will omit this proof, because it is very technical.
  However, we should at least verify that the Euclidean rhythm algorithm produces a rhythm with <m>k</m> onsets among <m>n</m> possible beats.
  It is not immediately clear that this is the case from the statement of the algorithm.
  </p>

  <theorem xml:id="thm-euclideanrhythmcorrectness">
    <statement>
      <p>
        The output of <m>\textrm{ER}(k,n)</m> is a sequence of <m>k</m> integers that sum to <m>n</m>.
      </p>
    </statement>
  </theorem>

  <proof>
    <p>
      We will use strong induction on <m>k</m>.
      The base case is when <m>k\mid n</m>, for which we have 
      <md>
        \textrm{ER}(k,n)=(\underbrace{\frac{n}{k},\frac{n}{k},\ldots, \frac{n}{k}}_{k\text{ times}})
      </md>
      and the result clearly holds in this case.      
    </p>
    <p>
      For the induction step, suppose <m>k\nmid n</m> and write <m>n=kq+r</m> with <m>0\leq r\lt k</m>.
      Since <m>r\lt k</m>, by induction we have that if
      <me>
        (x_1,\ldots,x_r)=\textrm{ER}(r,k)
      </me>
      then <m>x_1+\cdots +x_r=k</m>.
      Therefore, the sequence
      <me>
        \textrm{ER}(k,n)=(\underbrace{\left\lfloor \frac{n}{k} \right\rfloor,\ldots, \left\lfloor \frac{n}{k} \right\rfloor}_{x_1-1\text{ times}}, \left\lceil \frac{n}{k} \right\rceil, \underbrace{\left\lfloor \frac{n}{k} \right\rfloor,\ldots, \left\lfloor \frac{n}{k} \right\rfloor}_{x_2-1\text{ times}}, \left\lceil \frac{n}{k} \right\rceil,\ldots,\underbrace{\left\lfloor \frac{n}{k} \right\rfloor,\ldots, \left\lfloor \frac{n}{k} \right\rfloor}_{x_r-1\text{ times}}, \left\lceil \frac{n}{k} \right\rceil)
      </me>
      has <m>k</m> entries and has a sum given by
      <md>
        <mrow> r\left\lceil \frac{n}{k} \right\rceil + \left\lfloor \frac{n}{k} \right\rfloor \sum_{i=1}^r (x_i-1) \amp = r\left\lceil \frac{n}{k} \right\rceil + \left\lfloor \frac{n}{k} \right\rfloor (k-r)</mrow>
        <mrow> \amp = r\left( 1+\left\lfloor \frac{n}{k}\right\rfloor \right) + \left\lfloor \frac{n}{k}\right\rfloor (k-r)</mrow>
        <mrow> \amp = r+ k\left\lfloor \frac{n}{k}\right\rfloor </mrow>
        <mrow> \amp = r+kq </mrow>
        <mrow> \amp = n </mrow>
      </md>
      which completes the proof.     
    </p>
  </proof>
  
  <exercise>
    <p>
      Discuss this proof with your group. Does it make sense? Why or why not?
    </p>
  </exercise>

  <p>
    There are many fascinating mathematical connections with the theory of musical rhythm, these connections with the Euclidean algorithm are only one example.
    What is remarkable is that it took until the 21st century for people to discover these connections between rhythm and the Euclidean algorithm, an algorithm that is over 2,000 years old!
  </p>

</section>